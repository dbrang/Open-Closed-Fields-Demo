<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Open vs Closed Fields â€” EEG Demos</title>
  <style>
    :root{
      --bg:#f5f6f8;
      --panel:#ffffff;
      --line:#e6e8ee;
      --text:#111827;
      --muted:#6b7280;
      --shadow: 0 18px 50px rgba(0,0,0,.10);
      --radius: 16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:var(--bg);
      color:var(--text);
    }
    .wrap{max-width:1200px;margin:0 auto;padding:22px 16px 28px}
    header{
      display:flex;
      flex-wrap:wrap;
      gap:12px 18px;
      align-items:flex-end;
      justify-content:space-between;
      margin-bottom:12px;
    }
    .titleblock h1{margin:0;font-size:18px;font-weight:800;letter-spacing:-.01em}
    .titleblock p{margin:6px 0 0;font-size:13px;line-height:1.45;color:var(--muted);max-width:900px}
    .toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;justify-content:flex-end}
    .btn{
      border:1px solid var(--line);
      background:var(--panel);
      border-radius:999px;
      padding:8px 12px;
      font-size:12px;
      font-weight:750;
      color:#374151;
      cursor:pointer;
    }
    .btn:hover{border-color:#d7dbe5}
    .note{
      margin:10px 0 16px;
      padding:12px 14px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.72);
      border-radius:var(--radius);
      color:#334155;
      font-size:13px;
      line-height:1.45;
    }
    .stack{display:flex;flex-direction:column;gap:14px}
    .card{
      border:1px solid var(--line);
      background:var(--panel);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-width:0;
    }
    .cardHead{
      padding:12px 12px 10px;
      border-bottom:1px solid var(--line);
    }
    .cardHead h2{margin:0;font-size:13px;font-weight:850;color:#111827}
    .cardHead .sub{margin:4px 0 0;font-size:12px;line-height:1.35;color:var(--muted)}
    .embedWrap{
      position:relative;
      height:820px;
      min-height:520px;
      overflow:hidden;
      background:linear-gradient(180deg, rgba(17,24,39,.02), rgba(17,24,39,.00));
    }
    .embedWrap.compact{height:680px}
    iframe{
      width:100%;
      height:100%;
      border:0;
      display:block;
      background:white;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="titleblock">
        <h1>Open vs Closed Fields in EEG Recordings</h1>
      </div>
      <div class="toolbar">
        <button class="btn" id="reloadAll" type="button" title="Reload both demos">Reload demos</button>
      </div>
    </header>

    <div class="note">
      <b>Suggested flow:</b> (1) build intuition with dipole summation and cancellation, then (2) connect geometry/alignment to EEG waveform amplitude.
    </div>

    <main class="stack">
      <section class="card" id="panelA">
        <div class="cardHead">
          <h2>Alignment-driven summation (open vs closed field)</h2>
          <div class="sub">Heatmap of summed potential from multiple dipoles and simulated EEG electrode readout.</div>
        </div>
        <div class="embedWrap" id="wrapA">
          <iframe id="demoA" title="Demo A: Dipole summation heatmap"></iframe>
        </div>
      </section>

      <section class="card" id="panelB">
        <div class="cardHead">
          <h2>Layered cortex geometry + EEG waveform</h2>
          <div class="sub">Toggle neuron classes and adjust alignment/frequency; the EEG trace reflects summed vertical contribution. Large pyramidal neurons contribute the most to the EEG and are affected by alignment. Stellate cells contribute little due to their closed field structure.</div>
        </div>
        <div class="embedWrap compact" id="wrapB">
          <iframe id="demoB" title="Demo B: Layered cortex + EEG trace"></iframe>
        </div>
      </section>
    </main>
  </div>

  <script>
    // Embedded as base64 to keep this as a single, portable HTML file.
    const DEMO_A_B64 = "PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgPG1ldGEgY2hhcnNldD0idXRmLTgiIC8+CiAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCxpbml0aWFsLXNjYWxlPTEiIC8+CiAgPHRpdGxlPk9wZW4gdnMgQ2xvc2VkIEZpZWxkIOKAlCBTaW1wbGUgQWxpZ25tZW50IERlbW88L3RpdGxlPgogIDxzY3JpcHQgc3JjPSJodHRwczovL2NkbmpzLmNsb3VkZmxhcmUuY29tL2FqYXgvbGlicy9wNS5qcy8xLjYuMC9wNS5taW4uanMiPjwvc2NyaXB0PgogIDxzdHlsZT4KICAgIDpyb290ewogICAgICAtLWJnOiNmNWY2Zjg7CiAgICAgIC0tcGFuZWw6I2ZmZmZmZjsKICAgICAgLS1saW5lOiNlNmU4ZWU7CiAgICAgIC0tdGV4dDojMWYyOTM3OwogICAgICAtLW11dGVkOiM2YjcyODA7CiAgICAgIC0tYWNjZW50OiMyNTYzZWI7CiAgICB9CiAgICAqe2JveC1zaXppbmc6Ym9yZGVyLWJveH0KICAgIGJvZHl7CiAgICAgIG1hcmdpbjowOwogICAgICBmb250LWZhbWlseTogdWktc2Fucy1zZXJpZiwgc3lzdGVtLXVpLCAtYXBwbGUtc3lzdGVtLCBTZWdvZSBVSSwgUm9ib3RvLCBBcmlhbDsKICAgICAgYmFja2dyb3VuZDp2YXIoLS1iZyk7CiAgICAgIGNvbG9yOnZhcigtLXRleHQpOwogICAgICBoZWlnaHQ6MTAwdmg7CiAgICAgIG92ZXJmbG93OmhpZGRlbjsKICAgICAgZGlzcGxheTpmbGV4OwogICAgfQogICAgI3NpZGViYXJ7CiAgICAgIHdpZHRoOjMzMHB4OwogICAgICBiYWNrZ3JvdW5kOnZhcigtLXBhbmVsKTsKICAgICAgYm9yZGVyLXJpZ2h0OjFweCBzb2xpZCB2YXIoLS1saW5lKTsKICAgICAgcGFkZGluZzoxOHB4IDE2cHg7CiAgICAgIGRpc3BsYXk6ZmxleDsKICAgICAgZmxleC1kaXJlY3Rpb246Y29sdW1uOwogICAgICBnYXA6MTRweDsKICAgIH0KICAgIGgxe21hcmdpbjowOyBmb250LXNpemU6MTZweDsgZm9udC13ZWlnaHQ6NzUwfQogICAgcHttYXJnaW46MDsgZm9udC1zaXplOjEycHg7IGNvbG9yOnZhcigtLW11dGVkKTsgbGluZS1oZWlnaHQ6MS40fQogICAgLmdyb3VwewogICAgICBib3JkZXI6MXB4IHNvbGlkIHZhcigtLWxpbmUpOwogICAgICBib3JkZXItcmFkaXVzOjEycHg7CiAgICAgIHBhZGRpbmc6MTJweDsKICAgICAgYmFja2dyb3VuZDojZmZmOwogICAgfQogICAgbGFiZWx7CiAgICAgIGZvbnQtc2l6ZToxMnB4OwogICAgICBmb250LXdlaWdodDo2NTA7CiAgICAgIGNvbG9yOiMzNzQxNTE7CiAgICAgIGRpc3BsYXk6ZmxleDsKICAgICAganVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47CiAgICAgIGdhcDoxMHB4OwogICAgICBhbGlnbi1pdGVtczpiYXNlbGluZTsKICAgICAgbWFyZ2luLXRvcDoxMHB4OwogICAgfQogICAgLnZhbHtjb2xvcjp2YXIoLS1hY2NlbnQpOyBmb250LXdlaWdodDo4MDB9CiAgICBpbnB1dFt0eXBlPXJhbmdlXXt3aWR0aDoxMDAlfQogICAgLnJvd3sKICAgICAgZGlzcGxheTpncmlkOwogICAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmciA3OHB4OwogICAgICBnYXA6MTBweDsKICAgICAgYWxpZ24taXRlbXM6Y2VudGVyOwogICAgICBtYXJnaW4tdG9wOjhweDsKICAgIH0KICAgIC5zdGF0dXN7CiAgICAgIGJvcmRlcjoxcHggc29saWQgdmFyKC0tbGluZSk7CiAgICAgIGJvcmRlci1yYWRpdXM6MTJweDsKICAgICAgcGFkZGluZzoxMnB4OwogICAgICBiYWNrZ3JvdW5kOiAjZjhmYWZjOwogICAgICBmb250LXNpemU6MTJweDsKICAgICAgY29sb3I6IzMzNDE1NTsKICAgICAgbGluZS1oZWlnaHQ6MS40NTsKICAgICAgbWFyZ2luLXRvcDphdXRvOwogICAgfQogICAgLnRhZ3sKICAgICAgZGlzcGxheTppbmxpbmUtYmxvY2s7CiAgICAgIHBhZGRpbmc6M3B4IDhweDsKICAgICAgYm9yZGVyLXJhZGl1czo5OTlweDsKICAgICAgYmFja2dyb3VuZDojZWVmMmZmOwogICAgICBib3JkZXI6MXB4IHNvbGlkICNlMGU3ZmY7CiAgICAgIGNvbG9yOiMzNzMwYTM7CiAgICAgIGZvbnQtd2VpZ2h0Ojc1MDsKICAgICAgZm9udC1zaXplOjExcHg7CiAgICAgIG1hcmdpbi1ib3R0b206OHB4OwogICAgfQogICAgI2NhbnZhc1dyYXB7CiAgICAgIGZsZXg6MTsKICAgICAgZGlzcGxheTpmbGV4OwogICAgICBhbGlnbi1pdGVtczpjZW50ZXI7CiAgICAgIGp1c3RpZnktY29udGVudDpjZW50ZXI7CiAgICAgIHBvc2l0aW9uOnJlbGF0aXZlOwogICAgfQogICAgY2FudmFze2Rpc3BsYXk6YmxvY2s7IGJvcmRlci1yYWRpdXM6MTRweDsgYm94LXNoYWRvdzowIDE4cHggNTBweCByZ2JhKDAsMCwwLC4xMil9CiAgICAuaGludHsKICAgICAgcG9zaXRpb246YWJzb2x1dGU7CiAgICAgIGxlZnQ6MThweDsKICAgICAgYm90dG9tOjE4cHg7CiAgICAgIGJhY2tncm91bmQ6cmdiYSgyNTUsMjU1LDI1NSwuOTIpOwogICAgICBib3JkZXI6MXB4IHNvbGlkIHZhcigtLWxpbmUpOwogICAgICBib3JkZXItcmFkaXVzOjEycHg7CiAgICAgIHBhZGRpbmc6MTBweCAxMnB4OwogICAgICBmb250LXNpemU6MTJweDsKICAgICAgY29sb3I6IzMzNDE1NTsKICAgICAgbWF4LXdpZHRoOjU2MHB4OwogICAgICBsaW5lLWhlaWdodDoxLjQ7CiAgICAgIHBvaW50ZXItZXZlbnRzOm5vbmU7CiAgICB9CiAgICAuaGludCBie2NvbG9yOiMxMTE4Mjd9CiAgPC9zdHlsZT4KPC9oZWFkPgo8Ym9keT4KICA8ZGl2IGlkPSJzaWRlYmFyIj4KICAgIDxkaXY+CiAgICAgIDxoMT5FRUcgU3VtbWF0aW9uOiBPcGVuIHZzIENsb3NlZCBGaWVsZDwvaDE+CiAgICAgIDxwPgogICAgICAgIFRoaXMgZGVtbyB2aXN1YWxpemVzIHRoZSBpbmZsdWVuY2Ugb2YgbmV1cm9uIGFsaWdubWVudCBvbiB0aGUgZWxlY3RyaWNhbCBmaWVsZCB0aGF0IHNwcmVhZHMgdXAgdG8gRUVHIHJlY29yZGluZ3MuIFVzZSBOZXVyb24gQ291bnQgYW5kIEFsaWdubWVudCBzbGlkZXJzIHRvIHNlZSBleGFtcGxlcyBvZiBvcGVuIGZpZWxkcyAobmV1cm9ucyBhbGlnbmVkKSBhbmQgY2xvc2VkIGZpZWxkcyAobmV1cm9ucyBtaXNhbGlnbmVkIHNvIGZpZWxkcyBjYW5jZWwgb3V0KS4KICAgICAgPC9wPgogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0iZ3JvdXAiPgogICAgICA8bGFiZWwgZm9yPSJuU2xpZGVyIj5OZXVyb24gY291bnQgPHNwYW4gY2xhc3M9InZhbCIgaWQ9Im5WYWwiPjI8L3NwYW4+PC9sYWJlbD4KICAgICAgPGRpdiBjbGFzcz0icm93Ij4KICAgICAgICA8aW5wdXQgaWQ9Im5TbGlkZXIiIHR5cGU9InJhbmdlIiBtaW49IjIiIG1heD0iMjEiIHZhbHVlPSIyIiAvPgogICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZToxMnB4OyBjb2xvcjp2YXIoLS1tdXRlZCk7IHRleHQtYWxpZ246cmlnaHQiPk48L2Rpdj4KICAgICAgPC9kaXY+CgogICAgICA8bGFiZWwgZm9yPSJhU2xpZGVyIj5BbGlnbm1lbnQgPHNwYW4gY2xhc3M9InZhbCIgaWQ9ImFWYWwiPjEwMCU8L3NwYW4+PC9sYWJlbD4KICAgICAgPGRpdiBjbGFzcz0icm93Ij4KICAgICAgICA8aW5wdXQgaWQ9ImFTbGlkZXIiIHR5cGU9InJhbmdlIiBtaW49IjAiIG1heD0iMTAwIiB2YWx1ZT0iMTAwIiAvPgogICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZToxMnB4OyBjb2xvcjp2YXIoLS1tdXRlZCk7IHRleHQtYWxpZ246cmlnaHQiPiU8L2Rpdj4KICAgICAgPC9kaXY+Cgo8cCBzdHlsZT0ibWFyZ2luLXRvcDoxMHB4Ij4KICAgICAgICA8Yj4xMDAlPC9iPjogYWxsIGRpcG9sZXMgcGFyYWxsZWwgYW5kIHBvaW50aW5nIHVwd2FyZCAob3BlbiBmaWVsZCkuPGJyLz4KICAgICAgICA8Yj4wJTwvYj46IGRpcG9sZSBhbmdsZXMgYXJlIGV2ZW5seSBzcGFjZWQgb3ZlciAzNjDCsCwgc28gdGhlIG5ldCBkaXBvbGUgdmVjdG9yIGNhbmNlbHMgKGNsb3NlZCBmaWVsZCB0ZW5kZW5jeSkuPC9wPgogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0ic3RhdHVzIiBpZD0ic3RhdHVzQm94Ij4KICAgICAgPGRpdiBjbGFzcz0idGFnIiBpZD0idGFnIj5PcGVuIGZpZWxkPC9kaXY+CiAgICAgIDxkaXYgaWQ9InN0YXR1c1RleHQiPk5ldXJvbnMgYXJlIGxhcmdlbHkgcGFyYWxsZWwuIERpcG9sZXMgc3VtIGNvbnN0cnVjdGl2ZWx5LCBwcm9kdWNpbmcgYSBzdHJvbmcgZmFyLWZpZWxkIHRlbmRlbmN5LjwvZGl2PgogICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOjEwcHg7IGNvbG9yOnZhcigtLW11dGVkKSI+CiAgICAgICAgUmVhZG91dDogPGI+fFBuZXR8IC8gKE7Ct2QpPC9iPiA9IDxzcGFuIGlkPSJwUmF0aW8iPjEuMDA8L3NwYW4+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOjZweDsgY29sb3I6dmFyKC0tbXV0ZWQpIj4KICAgICAgICBFRUcgZWxlY3Ryb2RlOiA8Yj5WPC9iPiAow5cxMDAsIG5vcm1hbGl6ZWQpID0gPHNwYW4gaWQ9ImVlZ1ZhbCI+MC4wMDwvc3Bhbj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgc3R5bGU9Im1hcmdpbi10b3A6NnB4OyBmb250LXNpemU6MTJweDsgY29sb3I6dmFyKC0tbXV0ZWQpOyBsaW5lLWhlaWdodDoxLjQiPgoKICAgICAgICBXaGVyZSA8Yj5QbmV0PC9iPiA9IM6jPHN1Yj5pPC9zdWI+IDxiPnA8L2I+PHN1Yj5pPC9zdWI+IGlzIHRoZSB2ZWN0b3Igc3VtIG9mIGluZGl2aWR1YWwgZGlwb2xlIG1vbWVudHMsCiAgICAgICAgPGI+TjwvYj4gaXMgdGhlIG5ldXJvbiAoZGlwb2xlKSBjb3VudCwgYW5kIDxiPmQ8L2I+IGlzIHRoZSBwb2xlLXRvLXBvbGUgc2VwYXJhdGlvbiAoZGlwb2xlIGxlbmd0aCkuCiAgICAgICAgSW4gdGhpcyB0b3kgbW9kZWwsIGFsbCBkaXBvbGVzIHNoYXJlIHRoZSBzYW1lIDxiPmQ8L2I+LCBzbyB0aGUgcmVhZG91dCBpcyBhIDDigJMxIOKAnGNvaGVyZW5jZeKAnSBtZWFzdXJlLiA8Yj5WPC9iPiBpcyB0aGUgc3VtbWVkIHBvdGVudGlhbCBhdCB0aGUgRUVHIGVsZWN0cm9kZSBsb2NhdGlvbiAoc2FtZSBtb2RlbCBhcyB0aGUgaGVhdG1hcCksIG5vcm1hbGl6ZWQgYnkgdGhlIGN1cnJlbnQgbWF4IHxWfCBmb3IgYSBzdGFibGUgcmVhZG91dC4KICAgICAgPC9kaXY+CgogICAgPC9kaXY+CiAgPC9kaXY+CgogIDxkaXYgaWQ9ImNhbnZhc1dyYXAiPgogICAgPGRpdiBjbGFzcz0iaGludCI+CiAgICAgIDxiPkhvdyB0byByZWFkIHRoaXM6PC9iPiB0aGUgaGVhdG1hcCBzaG93cyB0aGUgPGI+c3VtbWVkIHBvdGVudGlhbDwvYj4gZnJvbSBhbGwgZGlwb2xlcyBvbiBhIDJEIHNsaWNlIChjb2xvcnMgYXJlIGF1dG8tbm9ybWFsaXplZCBmb3IgdmlzaWJpbGl0eSkuCiAgICAgIEFzIGFsaWdubWVudCBkZWNyZWFzZXMsIHRoZSA8Yj5uZXQgZGlwb2xlIHZlY3RvcjwvYj4gc2hyaW5rcyBiZWNhdXNlIGRpcG9sZXMgcG9pbnQgaW4gZGlmZmVyZW50IGRpcmVjdGlvbnMsIGlsbHVzdHJhdGluZyBob3cg4oCcY2xvc2VkIGZpZWxk4oCdIGdlb21ldHJ5IHJlZHVjZXMgdGhlIGZhci1maWVsZC4KICAgIDwvZGl2PgogIDwvZGl2PgoKPHNjcmlwdD4KLyoKICBTaW1wbGUgRUVHIHN1bW1hdGlvbiBkZW1vIChkZXRlcm1pbmlzdGljKQogIC0gVHdvIHNsaWRlcnM6IE4gYW5kIEFsaWdubWVudAogIC0gTGFyZ2UgbmV1cm9ucywgdGlnaHRseSBwYWNrZWQKICAtIERldGVybWluaXN0aWMsIGNvbnRpbnVvdXMgZmFuLW91dCAobm8gcmFuZG9tbmVzcykKICAtIEhlYXRtYXAgY29udHJhc3QgYm9vc3RlZCB0byBtYWtlIHN1bW1hdGlvbi9jYW5jZWxsYXRpb24gdmlzdWFsbHkgc2FsaWVudAoqLwoKbGV0IG5ldXJvbnMgPSBbXTsKbGV0IGdyaWQgPSBudWxsOwpsZXQgZ3JpZENvbHMgPSAwLCBncmlkUm93cyA9IDA7CmxldCBncmlkU2NhbGUgPSAxMDsgICAgICAgICAvLyBzbWFsbGVyIGJsb2NrcyA9IHNtb290aGVyLCBtb3JlIGxlZ2libGUgZmllbGQKbGV0IGRpcG9sZVNlcCA9IDE0MDsgICAgICAgIC8vIHB4IChkcmF3aW5nIGFuZCBmaWVsZCkKbGV0IHBvbGVSID0gMTg7ICAgICAgICAgICAgIC8vIHBvbGUgcmFkaXVzCmxldCBzaGFmdFcgPSAxNDsgICAgICAgICAgICAvLyBzaGFmdCB0aGlja25lc3MKCi8vIEZpZWxkIGZhbGxvZmYgZXhwb25lbnQ6IGxvd2VyID0+IHdpZGVyIGZpZWxkIHNwcmVhZCAvIG1vcmUgaW50ZXJhY3Rpb24KbGV0IGZpZWxkRmFsbG9mZkdhbW1hID0gMC43OwoKCgovLyBGaWVsZCBjb25zdGFudHMgKHVzZWQgZm9yIGhlYXRtYXAgKyBFRUcgZWxlY3Ryb2RlIHJlYWRvdXQpCmNvbnN0IEZJRUxEX0sgPSAyNDA7CmNvbnN0IEZJRUxEX0VQUyA9IDYuMDsKCi8vIEVFRyBlbGVjdHJvZGUgKHRvcC1vZi1wYW5lbCBzZW5zb3IpCmxldCBlZWdWYWxFbDsKbGV0IGVsZWN0cm9kZSA9IHsgeDogMCwgeTogMCwgcmF3OiAwLCBub3JtOiAwIH07Ci8vIFVJCmxldCBuU2xpZGVyLCBhU2xpZGVyLCBuVmFsLCBhVmFsLCBzdGF0dXNUZXh0LCB0YWdFbCwgcFJhdGlvRWw7CgpmdW5jdGlvbiBzZXR1cCgpIHsKICBjb25zdCB3cmFwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbnZhc1dyYXAnKTsKICBjb25zdCBjbnYgPSBjcmVhdGVDYW52YXMod3JhcC5jbGllbnRXaWR0aCAtIDQwLCB3cmFwLmNsaWVudEhlaWdodCAtIDQwKTsKICBjbnYucGFyZW50KCdjYW52YXNXcmFwJyk7CgogIG5TbGlkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnblNsaWRlcicpOwogIGFTbGlkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYVNsaWRlcicpOwogIG5WYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnblZhbCcpOwogIGFWYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYVZhbCcpOwogIHN0YXR1c1RleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhdHVzVGV4dCcpOwogIHRhZ0VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhZycpOwogIHBSYXRpb0VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BSYXRpbycpOwoKICAgIGVlZ1ZhbEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VlZ1ZhbCcpOwoKblNsaWRlci5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIHVwZGF0ZVNpbSk7CiAgYVNsaWRlci5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIHVwZGF0ZVNpbSk7CiAgbm9Mb29wKCk7ICAgICAvLyByZWRyYXcgb25seSBvbiBjaGFuZ2VzCiAgdXBkYXRlU2ltKCk7Cn0KCmZ1bmN0aW9uIHdpbmRvd1Jlc2l6ZWQoKSB7CiAgY29uc3Qgd3JhcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW52YXNXcmFwJyk7CiAgcmVzaXplQ2FudmFzKHdyYXAuY2xpZW50V2lkdGggLSA0MCwgd3JhcC5jbGllbnRIZWlnaHQgLSA0MCk7CiAgdXBkYXRlU2ltKCk7Cn0KCmZ1bmN0aW9uIHVwZGF0ZVNpbSgpIHsKICBjb25zdCBOID0gcGFyc2VJbnQoblNsaWRlci52YWx1ZSwgMTApOwogIGNvbnN0IEEgPSBwYXJzZUludChhU2xpZGVyLnZhbHVlLCAxMCk7CgogIG5WYWwudGV4dENvbnRlbnQgPSBOOwogIGFWYWwudGV4dENvbnRlbnQgPSBBICsgIiUiOwogIC8vIEZpZWxkIHNwcmVhZCBpcyBmaXhlZCAod2lkZSkgZm9yIGNsZWFyZXIgaW50ZXJhY3Rpb24uCiAgZmllbGRGYWxsb2ZmR2FtbWEgPSAwLjc7CiAgZ2VuZXJhdGVOZXVyb25zKE4sIEEpOwogIGNvbXB1dGVIZWF0bWFwKCk7CiAgdXBkYXRlU3RhdHVzKCk7CiAgdXBkYXRlRWxlY3Ryb2RlUmVhZG91dCgpOwogIHJlZHJhdygpOwp9CgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBEZXRlcm1pbmlzdGljIGdyYWR1YWwgYWxpZ25tZW50Ci8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgpmdW5jdGlvbiBnZW5lcmF0ZU5ldXJvbnMoTiwgYWxpZ25tZW50UGN0KSB7CiAgbmV1cm9ucyA9IFtdOwoKICBjb25zdCBhbGlnbiA9IGFsaWdubWVudFBjdCAvIDEwMC4wOyAvLyAxID0gYWxpZ25lZAogIGNvbnN0IG1pcyA9IDEuMCAtIGFsaWduOyAgICAgICAgICAgIC8vIDAuLjEKICBjb25zdCBiYXNlQW5nbGUgPSAtSEFMRl9QSTsgICAgICAgICAvLyAidXAiCgogIC8vIFRpZ2h0IHBhY2tpbmcgc28gcm90YXRpb25zIG92ZXJsYXAgKGFuZCBzbyBoaWdoZXIgTiBmaXRzIG9uIHNjcmVlbikKICAvLyB+MsOXIGNsb3NlciB0aGFuIHByaW9yIHZlcnNpb24sIHdpdGggYSBzYWZldHkgY2xhbXAgdG8ga2VlcCB0aGUgYXJyYXkgd2l0aGluIHZpZXcuCiAgY29uc3QgYmFzZVNwYWNpbmcgPSBkaXBvbGVTZXAgKiAwLjI3NTsKICBjb25zdCBtYXhTcGFuID0gTWF0aC5tYXgoODAsIHdpZHRoIC0gZGlwb2xlU2VwICogMS4yKTsKICBjb25zdCBzcGFjaW5nID0gKE4gPiAxKSA/IE1hdGgubWluKGJhc2VTcGFjaW5nLCBtYXhTcGFuIC8gKE4gLSAxKSkgOiBiYXNlU3BhY2luZzsKY29uc3QgdG90YWxXID0gKE4gLSAxKSAqIHNwYWNpbmc7CiAgY29uc3Qgc3RhcnRYID0gd2lkdGggLyAyIC0gdG90YWxXIC8gMjsKICBjb25zdCB5ID0gaGVpZ2h0ICogMC41ODsKCiAgLy8gS2VlcCBvbmUgbmV1cm9uIHZlcnRpY2FsIChhbmNob3IpLCBhbmQgcm90YXRlIG90aGVycyBkZXRlcm1pbmlzdGljYWxseS4KICAvLyBBdCAwJSBhbGlnbm1lbnQgKG1pcz0xKSwgZGlwb2xlIGFuZ2xlcyBhcmUgZXZlbmx5IHNwYWNlZCBvdmVyIDM2MMKwLAogIC8vIHdoaWNoIGd1YXJhbnRlZXMgzqMgdW5pdCB2ZWN0b3JzID0gMCAobmV0IGRpcG9sZSBjYW5jZWxzKSBmb3IgYW55IE4gPj0gMi4KICBjb25zdCBhbmNob3IgPSBNYXRoLmZsb29yKChOIC0gMSkgLyAyKTsKCiAgZm9yIChsZXQgaSA9IDA7IGkgPCBOOyBpKyspIHsKICAgIGNvbnN0IGRJZHggPSBpIC0gYW5jaG9yOyAgICAgICAgICAgICAgICAgLy8gLi4uLC0yLC0xLDAsMSwyLC4uLgogICAgY29uc3Qgb2Zmc2V0ID0gKFRXT19QSSAqIGRJZHgpIC8gTjsgICAgICAvLyBldmVubHkgc3BhY2VkIGFuZ2xlcwogICAgY29uc3QgYW5nbGUgPSBiYXNlQW5nbGUgKyBtaXMgKiBvZmZzZXQ7ICAvLyBjb250aW51b3VzIGludGVycG9sYXRpb24KICAgIG5ldXJvbnMucHVzaCh7IHg6IHN0YXJ0WCArIGkgKiBzcGFjaW5nLCB5LCBhbmdsZSB9KTsKICB9Cn0KCgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBGaWVsZCBtb2RlbCAoc291cmNlLXNpbmsgcGFpcikKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gY29tcHV0ZUhlYXRtYXAoKSB7CiAgZ3JpZENvbHMgPSBNYXRoLmZsb29yKHdpZHRoIC8gZ3JpZFNjYWxlKTsKICBncmlkUm93cyA9IE1hdGguZmxvb3IoaGVpZ2h0IC8gZ3JpZFNjYWxlKTsKICBncmlkID0gbmV3IEZsb2F0MzJBcnJheShncmlkQ29scyAqIGdyaWRSb3dzKTsKICBjb25zdCBrID0gRklFTERfSzsKICBjb25zdCBlcHMgPSBGSUVMRF9FUFM7CgogIGxldCBtYXhBYnMgPSAxZS05OwoKICBmb3IgKGxldCBqID0gMDsgaiA8IGdyaWRSb3dzOyBqKyspIHsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZ3JpZENvbHM7IGkrKykgewogICAgICBjb25zdCB4ID0gaSAqIGdyaWRTY2FsZSArIGdyaWRTY2FsZSAvIDI7CiAgICAgIGNvbnN0IHkgPSBqICogZ3JpZFNjYWxlICsgZ3JpZFNjYWxlIC8gMjsKCiAgICAgIGxldCBWID0gMDsKICAgICAgZm9yIChjb25zdCBuIG9mIG5ldXJvbnMpIHsKICAgICAgICBjb25zdCBkeCA9IE1hdGguY29zKG4uYW5nbGUpOwogICAgICAgIGNvbnN0IGR5ID0gTWF0aC5zaW4obi5hbmdsZSk7CgogICAgICAgIGNvbnN0IHN4ID0gbi54ICsgKGRpcG9sZVNlcCAvIDIpICogZHg7CiAgICAgICAgY29uc3Qgc3kgPSBuLnkgKyAoZGlwb2xlU2VwIC8gMikgKiBkeTsKICAgICAgICBjb25zdCBreCA9IG4ueCAtIChkaXBvbGVTZXAgLyAyKSAqIGR4OwogICAgICAgIGNvbnN0IGt5ID0gbi55IC0gKGRpcG9sZVNlcCAvIDIpICogZHk7CgogICAgICAgIGNvbnN0IHJTID0gTWF0aC5wb3coZGlzdCh4LCB5LCBzeCwgc3kpICsgZXBzLCBmaWVsZEZhbGxvZmZHYW1tYSk7CiAgICAgICAgY29uc3QgcksgPSBNYXRoLnBvdyhkaXN0KHgsIHksIGt4LCBreSkgKyBlcHMsIGZpZWxkRmFsbG9mZkdhbW1hKTsKCiAgICAgICAgViArPSAoayAvIHJTKSAtIChrIC8gckspOwogICAgICB9CgogICAgICBncmlkW2ogKiBncmlkQ29scyArIGldID0gVjsKICAgICAgY29uc3QgYSA9IE1hdGguYWJzKFYpOwogICAgICBpZiAoYSA+IG1heEFicykgbWF4QWJzID0gYTsKICAgIH0KICB9CiAgY29tcHV0ZUhlYXRtYXAubWF4QWJzID0gbWF4QWJzOwp9CgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBFRUcgZWxlY3Ryb2RlIHJlYWRvdXQKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gZWxlY3Ryb2RlUG90ZW50aWFsKGV4LCBleSkgewogIGNvbnN0IGsgPSBGSUVMRF9LOwogIGNvbnN0IGVwcyA9IEZJRUxEX0VQUzsKCiAgbGV0IFYgPSAwOwogIGZvciAoY29uc3QgbiBvZiBuZXVyb25zKSB7CiAgICBjb25zdCBkeCA9IE1hdGguY29zKG4uYW5nbGUpOwogICAgY29uc3QgZHkgPSBNYXRoLnNpbihuLmFuZ2xlKTsKCiAgICBjb25zdCBzeCA9IG4ueCArIChkaXBvbGVTZXAgLyAyKSAqIGR4OwogICAgY29uc3Qgc3kgPSBuLnkgKyAoZGlwb2xlU2VwIC8gMikgKiBkeTsKICAgIGNvbnN0IGt4ID0gbi54IC0gKGRpcG9sZVNlcCAvIDIpICogZHg7CiAgICBjb25zdCBreSA9IG4ueSAtIChkaXBvbGVTZXAgLyAyKSAqIGR5OwoKICAgIGNvbnN0IHJTID0gTWF0aC5wb3coZGlzdChleCwgZXksIHN4LCBzeSkgKyBlcHMsIGZpZWxkRmFsbG9mZkdhbW1hKTsKICAgIGNvbnN0IHJLID0gTWF0aC5wb3coZGlzdChleCwgZXksIGt4LCBreSkgKyBlcHMsIGZpZWxkRmFsbG9mZkdhbW1hKTsKCiAgICBWICs9IChrIC8gclMpIC0gKGsgLyBySyk7CiAgfQogIHJldHVybiBWOwp9CgpmdW5jdGlvbiB1cGRhdGVFbGVjdHJvZGVSZWFkb3V0KCkgewogIC8vIFBsYWNlIGVsZWN0cm9kZSBhYm92ZSB0aGUgbmV0IGRpcG9sZSBhbm5vdGF0aW9uLgogIGVsZWN0cm9kZS54ID0gd2lkdGggLyAyOwogIGVsZWN0cm9kZS55ID0gaGVpZ2h0ICogMC4xMDU7CgogIGVsZWN0cm9kZS5yYXcgPSBlbGVjdHJvZGVQb3RlbnRpYWwoZWxlY3Ryb2RlLngsIGVsZWN0cm9kZS55KTsKICBjb25zdCBtYXhBYnMgPSBjb21wdXRlSGVhdG1hcC5tYXhBYnMgfHwgMTsKICBlbGVjdHJvZGUubm9ybSA9IGVsZWN0cm9kZS5yYXcgLyBtYXhBYnM7CgogIGlmIChlZWdWYWxFbCkgewogICAgY29uc3QgZGlzcCA9IGVsZWN0cm9kZS5ub3JtICogMTAwLjA7CiAgICBjb25zdCBzaWduID0gZGlzcCA+PSAwID8gIisiIDogIiI7CiAgICBjb25zdCBkaWdpdHMgPSBNYXRoLmFicyhkaXNwKSA+PSAxID8gMCA6IDE7CiAgICBlZWdWYWxFbC50ZXh0Q29udGVudCA9IGAke3NpZ259JHtkaXNwLnRvRml4ZWQoZGlnaXRzKX1gOwogIH0KfQoKZnVuY3Rpb24gZHJhd1NrdWxsQW5kRWxlY3Ryb2RlKCkgewogIGNvbnN0IGN4ID0gd2lkdGggLyAyOwoKICAvLyBTa3VsbCBhcmMgKHN0eWxpemVkKQogIGNvbnN0IGFyY0N4ID0gY3g7CiAgY29uc3QgYXJjQ3kgPSBoZWlnaHQgKiAwLjA0NTsKICBjb25zdCBhcmNXID0gd2lkdGggKiAwLjc4OwogIGNvbnN0IGFyY0ggPSBoZWlnaHQgKiAwLjI4OwoKICBwdXNoKCk7CiAgbm9GaWxsKCk7CiAgc3Ryb2tlKDAsIDAsIDAsIDcwKTsKICBzdHJva2VXZWlnaHQoNSk7CiAgYXJjKGFyY0N4LCBhcmNDeSwgYXJjVywgYXJjSCwgcmFkaWFucygyMDApLCBUV09fUEkgLSByYWRpYW5zKDIwKSk7CiAgcG9wKCk7CgogIC8vIEVsZWN0cm9kZSBtYXJrZXIKICBjb25zdCBleCA9IGVsZWN0cm9kZS54IHx8IGN4OwogIGNvbnN0IGV5ID0gZWxlY3Ryb2RlLnkgfHwgaGVpZ2h0ICogMC4xMDU7CgogIC8vIENvbG9yIGJ5IHNpZ24vbWFnbml0dWRlIG9mIG1lYXN1cmVkIHBvdGVudGlhbCAobm9ybWFsaXplZCkKICBjb25zdCB3aGl0ZSA9IDI1MjsKICBjb25zdCBwb3MgPSB7IHI6IDI1NSwgZzogNzAsICBiOiA3MCB9OwogIGNvbnN0IG5lZyA9IHsgcjogNzAsICBnOiAxMTUsIGI6IDI1NSB9OwoKICBsZXQgdCA9IGNvbnN0cmFpbihlbGVjdHJvZGUubm9ybSAqIDIuMCwgLTEsIDEpOyAvLyBlbXBoYXNpemUgZm9yIHZpc2liaWxpdHkKICBjb25zdCBhID0gTWF0aC5wb3coTWF0aC5hYnModCksIDAuNjUpOwoKICBsZXQgciwgZywgYjsKICBpZiAodCA+PSAwKSB7CiAgICByID0gbGVycCh3aGl0ZSwgcG9zLnIsIGEpOwogICAgZyA9IGxlcnAod2hpdGUsIHBvcy5nLCBhKTsKICAgIGIgPSBsZXJwKHdoaXRlLCBwb3MuYiwgYSk7CiAgfSBlbHNlIHsKICAgIHIgPSBsZXJwKHdoaXRlLCBuZWcuciwgYSk7CiAgICBnID0gbGVycCh3aGl0ZSwgbmVnLmcsIGEpOwogICAgYiA9IGxlcnAod2hpdGUsIG5lZy5iLCBhKTsKICB9CgogIHB1c2goKTsKICBzdHJva2UoMCwgMCwgMCwgMTUwKTsKICBzdHJva2VXZWlnaHQoMi41KTsKICBmaWxsKHIsIGcsIGIpOwoKICAvLyBXaWRlIEVFRyBlbGVjdHJvZGUgKHN0eWxpemVkIG92YWwgc3Bhbm5pbmcgbW9zdCBvZiB0aGUgcGFuZWwgd2lkdGgpCiAgY29uc3QgZXcgPSB3aWR0aCAqIDAuNzg7CiAgY29uc3QgZWggPSAyMjsKICBlbGxpcHNlKGV4LCBleSwgZXcsIGVoKTsKCiAgLy8gTGVhZCBsaW5lIGRvd24gdG93YXJkIGNvcnRleCAoZnJvbSBlbGVjdHJvZGUgY2VudGVyKQogIHN0cm9rZSgwLCAwLCAwLCAxMTApOwogIHN0cm9rZVdlaWdodCgzKTsKICBsaW5lKGV4LCBleSArIGVoLzIsIGV4LCBleSArIGVoLzIgKyAyMCk7CgogIC8vIExhYmVscyAocGxhY2VkIGxlZnQgb2YgdGhlIG5ldC1kaXBvbGUgYXJyb3cgdG8gYXZvaWQgb3ZlcmxhcCkKICBub1N0cm9rZSgpOwogIGZpbGwoMCwgMCwgMCwgMTkwKTsKCiAgY29uc3QgbGFiZWxYID0gZXggLSAxODsKCiAgdGV4dEFsaWduKFJJR0hULCBCT1RUT00pOwogIHRleHRTaXplKDEyKTsKICBjb25zdCB0b3BMYWJlbFkgPSBNYXRoLm1heCgxNCwgZXkgLSBlaC8yIC0gMTApOwogIHRleHQoIkVFRyBlbGVjdHJvZGUiLCBsYWJlbFgsIHRvcExhYmVsWSk7CgogIGNvbnN0IGRpc3AgPSBlbGVjdHJvZGUubm9ybSAqIDEwMC4wOwogIGNvbnN0IHNpZ24gPSBkaXNwID49IDAgPyAiKyIgOiAiIjsKICBjb25zdCBkaWdpdHMgPSBNYXRoLmFicyhkaXNwKSA+PSAxID8gMCA6IDE7CgogIHRleHRBbGlnbihSSUdIVCwgVE9QKTsKICB0ZXh0U2l6ZSgxNCk7CiAgY29uc3QgYm90dG9tTGFiZWxZID0gTWF0aC5taW4oaGVpZ2h0IC0gMTQsIGV5ICsgZWgvMiArIDYpOwogIHRleHQoYFYg4omIICR7c2lnbn0ke2Rpc3AudG9GaXhlZChkaWdpdHMpfWAsIGxhYmVsWCwgYm90dG9tTGFiZWxZKTsKICBwb3AoKTsKfQoKZnVuY3Rpb24gZHJhd0hlYXRtYXAoKSB7CiAgbm9TdHJva2UoKTsKICBjb25zdCBtYXhBYnMgPSBjb21wdXRlSGVhdG1hcC5tYXhBYnMgfHwgMTsKCiAgLy8gQ29udHJhc3QgY29udHJvbHMgKGZpeGVkOyBubyBleHRyYSBzbGlkZXJzKQogIGNvbnN0IGdhaW4gPSAyLjQ7ICAgICAgLy8gYm9vc3RzIG1pZC1yYW5nZSB2YWx1ZXMKICBjb25zdCBnYW1tYSA9IDAuNTU7ICAgIC8vIDwgMSBtYWtlcyB2YWx1ZXMgYXdheSBmcm9tIDAgbW9yZSB2aXNpYmxlCiAgY29uc3Qgd2hpdGUgPSAyNTI7CgogIC8vIEVuZHBvaW50cyAoc2F0dXJhdGVkLCBoaWdoIHNhbGllbmNlKQogIGNvbnN0IHBvcyA9IHtyOjI1NSwgZzo3MCwgIGI6NzB9OyAgIC8vIHJlZAogIGNvbnN0IG5lZyA9IHtyOjcwLCAgZzoxMTUsIGI6MjU1fTsgIC8vIGJsdWUKCiAgZm9yIChsZXQgaiA9IDA7IGogPCBncmlkUm93czsgaisrKSB7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGdyaWRDb2xzOyBpKyspIHsKICAgICAgY29uc3QgViA9IGdyaWRbaiAqIGdyaWRDb2xzICsgaV07CgogICAgICAvLyBOb3JtYWxpemUsIHRoZW4gYXBwbHkgZ2FpbiArIGdhbW1hIGZvciBzdHJvbmdlciBmaWVsZCB2aXNpYmlsaXR5CiAgICAgIGxldCB0ID0gViAvIG1heEFiczsKICAgICAgdCA9IGNvbnN0cmFpbih0ICogZ2FpbiwgLTEsIDEpOwogICAgICBjb25zdCBhID0gTWF0aC5wb3coTWF0aC5hYnModCksIGdhbW1hKTsKICAgICAgY29uc3QgcyA9IE1hdGguc2lnbih0KTsKCiAgICAgIC8vIE1peCBlbmRwb2ludCBjb2xvciB3aXRoIG5lYXItd2hpdGUgYmFja2dyb3VuZAogICAgICBsZXQgciwgZywgYjsKICAgICAgaWYgKHMgPj0gMCkgewogICAgICAgIHIgPSBsZXJwKHdoaXRlLCBwb3MuciwgYSk7CiAgICAgICAgZyA9IGxlcnAod2hpdGUsIHBvcy5nLCBhKTsKICAgICAgICBiID0gbGVycCh3aGl0ZSwgcG9zLmIsIGEpOwogICAgICB9IGVsc2UgewogICAgICAgIHIgPSBsZXJwKHdoaXRlLCBuZWcuciwgYSk7CiAgICAgICAgZyA9IGxlcnAod2hpdGUsIG5lZy5nLCBhKTsKICAgICAgICBiID0gbGVycCh3aGl0ZSwgbmVnLmIsIGEpOwogICAgICB9CgogICAgICBmaWxsKHIsIGcsIGIpOwogICAgICByZWN0KGkgKiBncmlkU2NhbGUsIGogKiBncmlkU2NhbGUsIGdyaWRTY2FsZSArIDEsIGdyaWRTY2FsZSArIDEpOwogICAgfQogIH0KCiAgLy8gc3VidGxlIHZpZ25ldHRlCiAgcHVzaCgpOwogIG5vRmlsbCgpOwogIHN0cm9rZSgwLDAsMCwyNCk7CiAgc3Ryb2tlV2VpZ2h0KDE2KTsKICByZWN0KDAsMCx3aWR0aCxoZWlnaHQsMjApOwogIHBvcCgpOwp9CgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBOZXVyb24gZHJhd2luZyAoYmlnIGFuZCBvYnZpb3VzKQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpmdW5jdGlvbiBkcmF3TmV1cm9uKHgsIHksIGFuZ2xlKSB7CiAgcHVzaCgpOwogIHRyYW5zbGF0ZSh4LCB5KTsKICByb3RhdGUoYW5nbGUpOwoKICAvLyBzaGFmdAogIHN0cm9rZSg3MCwgNzAsIDcwLCAyMTApOwogIHN0cm9rZVdlaWdodChzaGFmdFcpOwogIHN0cm9rZUNhcChST1VORCk7CiAgbGluZSgtZGlwb2xlU2VwLzIsIDAsIGRpcG9sZVNlcC8yLCAwKTsKCiAgLy8gc2luayAoYmx1ZSkgb24gbGVmdAogIG5vU3Ryb2tlKCk7CiAgZmlsbCgzMCwgNzUsIDIzMCk7CiAgY2lyY2xlKC1kaXBvbGVTZXAvMiwgMCwgcG9sZVIqMi4yKTsKICBmaWxsKDI1NSk7CiAgdGV4dEFsaWduKENFTlRFUiwgQ0VOVEVSKTsKICB0ZXh0U2l6ZSgxNik7CiAgdGV4dCgi4oiSIiwgLWRpcG9sZVNlcC8yLCAxKTsKCiAgLy8gc291cmNlIChyZWQpIG9uIHJpZ2h0CiAgZmlsbCgyMzUsIDYwLCA2MCk7CiAgY2lyY2xlKGRpcG9sZVNlcC8yLCAwLCBwb2xlUioyLjIpOwogIGZpbGwoMjU1KTsKICB0ZXh0KCIrIiwgZGlwb2xlU2VwLzIsIDEpOwoKICAvLyBhcnJvd2hlYWQgbmVhciArIGVuZAogIGZpbGwoMjM1LCA2MCwgNjApOwogIGNvbnN0IGF4ID0gZGlwb2xlU2VwLzIgKyBwb2xlUioxLjE7CiAgdHJpYW5nbGUoYXgsIDAsIGF4LTE0LCAtMTAsIGF4LTE0LCAxMCk7CgogIHBvcCgpOwp9CgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBOZXQgZGlwb2xlIHJlYWRvdXQgKyBzdGF0dXMKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gbmV0RGlwb2xlKCkgewogIGxldCBweCA9IDAsIHB5ID0gMDsKICBjb25zdCBkID0gZGlwb2xlU2VwOwogIGZvciAoY29uc3QgbiBvZiBuZXVyb25zKSB7CiAgICBweCArPSBkICogTWF0aC5jb3Mobi5hbmdsZSk7CiAgICBweSArPSBkICogTWF0aC5zaW4obi5hbmdsZSk7CiAgfQogIHJldHVybiB7cHgsIHB5LCBkLCBtYWc6IE1hdGguc3FydChweCpweCArIHB5KnB5KX07Cn0KCmZ1bmN0aW9uIGRyYXdOZXREaXBvbGVBcnJvdygpIHsKICBjb25zdCBQID0gbmV0RGlwb2xlKCk7CiAgY29uc3QgTiA9IG5ldXJvbnMubGVuZ3RoIHx8IDE7CiAgY29uc3QgcmF0aW8gPSBQLm1hZyAvIChOICogKFAuZCB8fCAxKSk7CgogIGNvbnN0IGN4ID0gd2lkdGgvMjsKICAvLyBQbGFjZSB0aGUgbmV0LWRpcG9sZSBhbm5vdGF0aW9uIGEgYml0IGxvd2VyIHNvIGl0IHN0YXlzIGluIHZpZXcgb24gc2hvcnRlciBzY3JlZW5zLgogIGNvbnN0IGN5ID0gaGVpZ2h0KjAuMjI7CgogIC8vIERlc2lyZWQgYXJyb3cgbGVuZ3RoIChzY2FsZWQgYnkgY29oZXJlbmNlIHJhdGlvKQogIGNvbnN0IEwwID0gMTQwICogcmF0aW87CgogIGNvbnN0IGFuZyA9IE1hdGguYXRhbjIoUC5weSwgUC5weCk7CiAgY29uc3QgYyA9IE1hdGguY29zKGFuZyk7CiAgY29uc3QgcyA9IE1hdGguc2luKGFuZyk7CgogIC8vIENsYW1wIGFycm93IHNvIHRoZSB0aXAgc3RheXMgd2l0aGluIHRoZSBjYW52YXMgYm91bmRzLgogIGNvbnN0IG1hcmdpbiA9IDI4OwogIGxldCBtYXhMeCA9IEluZmluaXR5OwogIGlmIChNYXRoLmFicyhjKSA+IDFlLTYpIHsKICAgIG1heEx4ID0gKGMgPiAwKSA/ICh3aWR0aCAtIG1hcmdpbiAtIGN4KSAvIGMgOiAoY3ggLSBtYXJnaW4pIC8gKC1jKTsKICB9CiAgbGV0IG1heEx5ID0gSW5maW5pdHk7CiAgaWYgKE1hdGguYWJzKHMpID4gMWUtNikgewogICAgbWF4THkgPSAocyA+IDApID8gKGhlaWdodCAtIG1hcmdpbiAtIGN5KSAvIHMgOiAoY3kgLSBtYXJnaW4pIC8gKC1zKTsKICB9CiAgY29uc3QgTCA9IE1hdGgubWF4KDAsIE1hdGgubWluKEwwLCBtYXhMeCwgbWF4THkpKTsKCiAgcHVzaCgpOwogIHN0cm9rZSgwLDAsMCwxNjApOwogIHN0cm9rZVdlaWdodCg0KTsKICBmaWxsKDAsMCwwLDE2MCk7CgogIGNvbnN0IHgyID0gY3ggKyBMICogYzsKICBjb25zdCB5MiA9IGN5ICsgTCAqIHM7CgogIGxpbmUoY3gsIGN5LCB4MiwgeTIpOwoKICBjb25zdCBoZWFkID0gMTQ7CiAgY29uc3QgYTEgPSBhbmcgKyByYWRpYW5zKDE1MCk7CiAgY29uc3QgYTIgPSBhbmcgLSByYWRpYW5zKDE1MCk7CiAgdHJpYW5nbGUoCiAgICB4MiwgeTIsCiAgICB4MiArIGhlYWQgKiBNYXRoLmNvcyhhMSksIHkyICsgaGVhZCAqIE1hdGguc2luKGExKSwKICAgIHgyICsgaGVhZCAqIE1hdGguY29zKGEyKSwgeTIgKyBoZWFkICogTWF0aC5zaW4oYTIpCiAgKTsKCiAgbm9TdHJva2UoKTsKICBmaWxsKDAsMCwwLDE5MCk7CiAgLy8gTW92ZSB0aGUgdGV4dCBsZWZ0IHNvIGl0IGRvZXNuJ3Qgb3ZlcmxhcCB0aGUgYXJyb3cgc2hhZnQuCiAgdGV4dEFsaWduKFJJR0hULCBDRU5URVIpOwogIHRleHRTaXplKDE0KTsKICBjb25zdCBsYWJlbFkgPSBNYXRoLm1heChtYXJnaW4sIGN5IC0gMjYpOwogIGNvbnN0IGxhYmVsWCA9IGN4IC0gMTg7CiAgdGV4dChgTmV0IGRpcG9sZSB8UG5ldHwvKE7Ct2QpIOKJiCAke3JhdGlvLnRvRml4ZWQoMil9YCwgbGFiZWxYLCBsYWJlbFkpOwogIHBvcCgpOwp9CgoKZnVuY3Rpb24gdXBkYXRlU3RhdHVzKCkgewogIGNvbnN0IFAgPSBuZXREaXBvbGUoKTsKICBjb25zdCBOID0gbmV1cm9ucy5sZW5ndGggfHwgMTsKICBjb25zdCByYXRpbyA9IFAubWFnIC8gKE4gKiAoUC5kIHx8IDEpKTsKICBwUmF0aW9FbC50ZXh0Q29udGVudCA9IHJhdGlvLnRvRml4ZWQoMik7CgogIGlmIChyYXRpbyA+IDAuNzApIHsKICAgIHRhZ0VsLnRleHRDb250ZW50ID0gIk9wZW4gZmllbGQiOwogICAgdGFnRWwuc3R5bGUuYmFja2dyb3VuZCA9ICIjZWNmZGY1IjsKICAgIHRhZ0VsLnN0eWxlLmJvcmRlckNvbG9yID0gIiNiYmY3ZDAiOwogICAgdGFnRWwuc3R5bGUuY29sb3IgPSAiIzA2NWY0NiI7CiAgICBzdGF0dXNUZXh0LnRleHRDb250ZW50ID0gIk5ldXJvbnMgYXJlIGxhcmdlbHkgcGFyYWxsZWwuIERpcG9sZXMgc3VtIGNvbnN0cnVjdGl2ZWx5LCBwcm9kdWNpbmcgYSBzdHJvbmcgZmFyLWZpZWxkIHRlbmRlbmN5LiI7CiAgfSBlbHNlIGlmIChyYXRpbyA8IDAuMjUpIHsKICAgIHRhZ0VsLnRleHRDb250ZW50ID0gIkNsb3NlZCBmaWVsZCB0ZW5kZW5jeSI7CiAgICB0YWdFbC5zdHlsZS5iYWNrZ3JvdW5kID0gIiNmZWYyZjIiOwogICAgdGFnRWwuc3R5bGUuYm9yZGVyQ29sb3IgPSAiI2ZlY2FjYSI7CiAgICB0YWdFbC5zdHlsZS5jb2xvciA9ICIjN2YxZDFkIjsKICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSAiTmV1cm9ucyBhcmUgc3Ryb25nbHkgbWlzYWxpZ25lZC4gRGlwb2xlIHZlY3RvcnMgY2FuY2VsLCByZWR1Y2luZyB0aGUgZmFyLWZpZWxkIChldmVuIGlmIGxvY2FsIGZpZWxkcyBleGlzdCkuIjsKICB9IGVsc2UgewogICAgdGFnRWwudGV4dENvbnRlbnQgPSAiUGFydGlhbCBzdW1tYXRpb24iOwogICAgdGFnRWwuc3R5bGUuYmFja2dyb3VuZCA9ICIjZmZmYmViIjsKICAgIHRhZ0VsLnN0eWxlLmJvcmRlckNvbG9yID0gIiNmZGU2OGEiOwogICAgdGFnRWwuc3R5bGUuY29sb3IgPSAiIzc4MzUwZiI7CiAgICBzdGF0dXNUZXh0LnRleHRDb250ZW50ID0gIkludGVybWVkaWF0ZSBhbGlnbm1lbnQuIFNvbWUgY29uc3RydWN0aXZlIHN1bW1hdGlvbiByZW1haW5zLCBidXQgY2FuY2VsbGF0aW9uIGdyb3dzIGFzIG5ldXJvbnMgZmFuIG91dC4iOwogIH0KfQoKZnVuY3Rpb24gZHJhdygpIHsKICBiYWNrZ3JvdW5kKDI0NSk7CgogIGlmIChncmlkKSBkcmF3SGVhdG1hcCgpOwoKICAvLyBzdWJ0bGUgYXhlcwogIHN0cm9rZSgwLCAwLCAwLCAzNSk7CiAgc3Ryb2tlV2VpZ2h0KDIpOwogIGxpbmUod2lkdGgvMiwgMCwgd2lkdGgvMiwgaGVpZ2h0KTsKICBsaW5lKDAsIGhlaWdodC8yLCB3aWR0aCwgaGVpZ2h0LzIpOwoKICAvLyBuZXVyb25zCiAgZm9yIChjb25zdCBuIG9mIG5ldXJvbnMpIGRyYXdOZXVyb24obi54LCBuLnksIG4uYW5nbGUpOwoKICAKICAvLyBza3VsbCArIEVFRyBlbGVjdHJvZGUKICBkcmF3U2t1bGxBbmRFbGVjdHJvZGUoKTsKCi8vIG5ldCBkaXBvbGUgYXJyb3cKICBkcmF3TmV0RGlwb2xlQXJyb3coKTsKfQo8L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+Cg==";
    const DEMO_B_B64 = "PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CjxtZXRhIGNoYXJzZXQ9InV0Zi04Ii8+Cjx0aXRsZT5PcGVuIHZzIENsb3NlZCBGaWVsZCBFRUcg4oCTIEZpbmFsIE1vZGVsPC90aXRsZT4KPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xIi8+CjxzdHlsZT4KYm9keXttYXJnaW46MDtiYWNrZ3JvdW5kOiMwMjA2MTc7Y29sb3I6I2U1ZTdlYjtmb250LWZhbWlseTpzeXN0ZW0tdWksU2Vnb2UgVUksUm9ib3RvfQoud3JhcHttYXgtd2lkdGg6MTIwMHB4O21hcmdpbjowIGF1dG87cGFkZGluZzoxNnB4fQpoMXtmb250LXNpemU6MThweDttYXJnaW46MCAwIDZweH0KLnBhbmVse2JhY2tncm91bmQ6IzBiMTIyMDtib3JkZXI6MXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsLjEyKTtib3JkZXItcmFkaXVzOjE2cHg7cGFkZGluZzoxMnB4fQouZ3JpZHtkaXNwbGF5OmdyaWQ7Z3JpZC10ZW1wbGF0ZS1jb2x1bW5zOjJmciAxZnI7Z2FwOjEycHh9Ci5jb250cm9scyBsYWJlbHtkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47Zm9udC1zaXplOjEycHg7bWFyZ2luOjEwcHggMCA0cHh9Ci5jb250cm9scyBpbnB1dFt0eXBlPXJhbmdlXXt3aWR0aDoxMDAlfQouY29udHJvbHMgaW5wdXRbdHlwZT1jaGVja2JveF17bWFyZ2luLXJpZ2h0OjZweH0KY2FudmFze2JhY2tncm91bmQ6IzAyMDYxNztib3JkZXI6MXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsLjEyKTtib3JkZXItcmFkaXVzOjEycHh9Ci5zbWFsbHtmb250LXNpemU6MTJweDtjb2xvcjpyZ2JhKDIyOSwyMzEsMjM1LC42KX0KLnJvd3tkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDo4cHg7Zm9udC1zaXplOjEzcHh9Cjwvc3R5bGU+CjwvaGVhZD4KPGJvZHk+CjxkaXYgY2xhc3M9IndyYXAiPgo8aDE+RUVHIE9wZW4gdnMgQ2xvc2VkIEZpZWxkIOKAkyBHZW9tZXRyaWMgTW9kZWw8L2gxPgo8ZGl2IGNsYXNzPSJncmlkIj4KPGRpdiBjbGFzcz0icGFuZWwiPgo8Y2FudmFzIGlkPSJjb3J0ZXgiIHdpZHRoPSI3MjAiIGhlaWdodD0iNDIwIj48L2NhbnZhcz4KPGRpdiBjbGFzcz0ic21hbGwiPlB5cmFtaWRhbCBuZXVyb25zIHJvdGF0ZSBhcm91bmQgdGhlaXIgc29tYS4gTDYgbmV1cm9ucyBzcGFuIG11bHRpcGxlIGxheWVycy4gU3RlbGxhdGUgY2VsbHMgKEw0KSByZW1haW4gbG9jYWxseSBzeW1tZXRyaWMuPC9kaXY+CjwvZGl2PgoKPGRpdiBjbGFzcz0icGFuZWwgY29udHJvbHMiPgo8bGFiZWw+QWxpZ25tZW50IDxzcGFuIGlkPSJhbGlnblZhbCI+MTAwJTwvc3Bhbj48L2xhYmVsPgo8aW5wdXQgaWQ9ImFsaWduIiB0eXBlPSJyYW5nZSIgbWluPSIwIiBtYXg9IjEiIHN0ZXA9IjAuMDEiIHZhbHVlPSIxIiBvbmlucHV0PSJkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWxpZ25WYWwnKS5pbm5lclRleHQgPSBNYXRoLnJvdW5kKHRoaXMudmFsdWUqMTAwKSsnJSciPgoKPGxhYmVsPkZyZXF1ZW5jeSA8c3BhbiBpZD0iZnJlcVZhbCI+MSBIejwvc3Bhbj48L2xhYmVsPgo8aW5wdXQgaWQ9ImZyZXEiIHR5cGU9InJhbmdlIiBtaW49IjAuMiIgbWF4PSIxMCIgc3RlcD0iMC4xIiB2YWx1ZT0iMSIgb25pbnB1dD0iZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZyZXFWYWwnKS5pbm5lclRleHQgPSB0aGlzLnZhbHVlKycgSHonIj4KCjxociBzdHlsZT0iYm9yZGVyOm5vbmU7Ym9yZGVyLXRvcDoxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwuMTIpO21hcmdpbjoxMnB4IDAiPgoKPGRpdiBjbGFzcz0icm93Ij4KPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0ic2hvd0wyMyIgY2hlY2tlZD4gTDIvMyBweXJhbWlkYWwKPC9kaXY+CjxkaXYgY2xhc3M9InJvdyI+CjxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InNob3dMNiIgY2hlY2tlZD4gTDYgcHlyYW1pZGFsCjwvZGl2Pgo8ZGl2IGNsYXNzPSJyb3ciPgo8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJzaG93U3RlbGxhdGUiIGNoZWNrZWQ+IFN0ZWxsYXRlIChMNCkKPC9kaXY+Cgo8aHIgc3R5bGU9ImJvcmRlcjpub25lO2JvcmRlci10b3A6MXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsLjEyKTttYXJnaW46MTJweCAwIj4KCjxkaXYgY2xhc3M9InJvdyI+CjxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InZpc3VhbGl6ZUZpcmluZyIgY2hlY2tlZD4gPHN0cm9uZz5WaXN1YWxpemUgRmlyaW5nPC9zdHJvbmc+CjwvZGl2PgoKPGNhbnZhcyBpZD0iZWVnIiB3aWR0aD0iMzYwIiBoZWlnaHQ9IjE2MCIgc3R5bGU9Im1hcmdpbi10b3A6MTJweCI+PC9jYW52YXM+CjxkaXYgY2xhc3M9InNtYWxsIj5FRUcgdHJhY2UgcmVwcmVzZW50cyB0aGUgc3VtbWVkIHZlcnRpY2FsIHBvdGVudGlhbCBvZiBhbGwgYWN0aXZlIG5ldXJvbnMuPC9kaXY+CjwvZGl2Pgo8L2Rpdj4KPC9kaXY+Cgo8c2NyaXB0Pgpjb25zdCBjb3J0ZXg9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvcnRleCIpOwpjb25zdCBjdHg9Y29ydGV4LmdldENvbnRleHQoIjJkIik7CmNvbnN0IGVlZz1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWVnIik7CmNvbnN0IGVjdHg9ZWVnLmdldENvbnRleHQoIjJkIik7CgovLyBMYXllcnMgZGVmaW5pdGlvbnMKY29uc3QgbGF5ZXJzPVsKe25hbWU6IkkiLHk6NjB9LHtuYW1lOiJJSS9JSUkiLHk6MTQwfSx7bmFtZToiSVYiLHk6MjIwfSx7bmFtZToiVi9WSSIseTozMzB9Cl07CgovLyBQcmUtY2FsY3VsYXRlIHJhbmRvbSBzZWVkcyBmb3IgZXZlcnkgcG9zc2libGUgbmV1cm9uIHNvIHRoZXkgcm90YXRlIHN0YWJseQpjb25zdCBuZXVyb25NYXAgPSBbXTsKZm9yKGxldCBjPTA7IGM8MTA7IGMrKyl7CiAgICBuZXVyb25NYXBbY10gPSBbXTsKICAgIGZvcihsZXQgbD0wOyBsPDU7IGwrKyl7CiAgICAgICAgbmV1cm9uTWFwW2NdW2xdID0gewogICAgICAgICAgICBhbmdsZU9mZnNldDogKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMiAqIE1hdGguUEksIAogICAgICAgICAgICBwaGFzZU9mZnNldDogTWF0aC5yYW5kb20oKSAqIDIgKiBNYXRoLlBJIAogICAgICAgIH07CiAgICB9Cn0KCmxldCB0PTAsbGFzdD1wZXJmb3JtYW5jZS5ub3coKTsKCi8vIEhlbHBlciB0byBnZXQgY29sb3Igd2l0aCBhbHBoYSBiYXNlZCBvbiBhY3Rpdml0eQpmdW5jdGlvbiBnZXREeW5hbWljQ29sb3IoYmFzZUNvbG9ySGV4LCBhY3Rpdml0eSwgaXNGaXJpbmdFbmFibGVkKSB7CiAgICBpZighaXNGaXJpbmdFbmFibGVkKSByZXR1cm4gYmFzZUNvbG9ySGV4OwogICAgLy8gQWN0aXZpdHkgaXMgc2luIHdhdmUgLTEgdG8gMS4gTWFwIHRvIG9wYWNpdHkgMC4zIHRvIDEuMAogICAgY29uc3QgaW50ZW5zaXR5ID0gMC40ICsgMC42ICogKChhY3Rpdml0eSArIDEpIC8gMik7CiAgICAKICAgIC8vIENvbnZlcnQgaGV4IHRvIHJnYgogICAgY29uc3QgciA9IHBhcnNlSW50KGJhc2VDb2xvckhleC5zbGljZSgxLDMpLCAxNik7CiAgICBjb25zdCBnID0gcGFyc2VJbnQoYmFzZUNvbG9ySGV4LnNsaWNlKDMsNSksIDE2KTsKICAgIGNvbnN0IGIgPSBwYXJzZUludChiYXNlQ29sb3JIZXguc2xpY2UoNSw3KSwgMTYpOwogICAgCiAgICByZXR1cm4gYHJnYmEoJHtyfSwke2d9LCR7Yn0sJHtpbnRlbnNpdHl9KWA7Cn0KCmZ1bmN0aW9uIGRyYXdQeXJhbWlkYWwoeCwgeVNvbWEsIGxlbmd0aCwgYW5nbGUsIGNvbG9yKSB7CiAgICBjdHguc2F2ZSgpOwogICAgY3R4LnRyYW5zbGF0ZSh4LCB5U29tYSk7CiAgICBjdHgucm90YXRlKGFuZ2xlKTsgCgogICAgY3R4LnN0cm9rZVN0eWxlID0gY29sb3I7CiAgICBjdHgubGluZVdpZHRoID0gMjsKICAgIGN0eC5maWxsU3R5bGUgPSBjb2xvcjsKCiAgICAvLyBTb21hCiAgICBjdHguYmVnaW5QYXRoKCk7CiAgICBjdHguYXJjKDAsIDAsIDYsIDAsIE1hdGguUEkgKiAyKTsKICAgIGN0eC5maWxsKCk7CgogICAgLy8gQXBpY2FsIERlbmRyaXRlCiAgICBjdHguYmVnaW5QYXRoKCk7CiAgICBjdHgubW92ZVRvKDAsIDApOwogICAgY3R4LmxpbmVUbygwLCAtbGVuZ3RoKTsKICAgIGN0eC5zdHJva2UoKTsKCiAgICAvLyBBcGljYWwgdHVmdAogICAgY3R4LmJlZ2luUGF0aCgpOwogICAgY3R4Lm1vdmVUbygwLCAtbGVuZ3RoKTsKICAgIGN0eC5saW5lVG8oLTgsIC1sZW5ndGggLSAxMCk7CiAgICBjdHgubW92ZVRvKDAsIC1sZW5ndGgpOwogICAgY3R4LmxpbmVUbyg4LCAtbGVuZ3RoIC0gMTApOwogICAgY3R4LnN0cm9rZSgpOwoKICAgIC8vIEJhc2FsIGRlbmRyaXRlcwogICAgY3R4LmJlZ2luUGF0aCgpOwogICAgY3R4Lm1vdmVUbygwLDApOwogICAgY3R4LmxpbmVUbygtNiwgMTApOwogICAgY3R4Lm1vdmVUbygwLDApOwogICAgY3R4LmxpbmVUbyg2LCAxMCk7CiAgICBjdHguc3Ryb2tlKCk7CgogICAgY3R4LnJlc3RvcmUoKTsKfQoKZnVuY3Rpb24gZHJhd1N0ZWxsYXRlTmV1cm9uKHgsIHksIGNvbG9yKSB7CiAgICBjdHguZmlsbFN0eWxlID0gY29sb3I7CiAgICBjdHguc3Ryb2tlU3R5bGUgPSBjb2xvcjsKICAgIGN0eC5saW5lV2lkdGggPSAxLjU7CgogICAgY3R4LmJlZ2luUGF0aCgpOwogICAgY3R4LmFyYyh4LCB5LCA1LCAwLCBNYXRoLlBJKjIpOwogICAgY3R4LmZpbGwoKTsKCiAgICBjb25zdCBwcm9jZXNzZXMgPSA2OwogICAgZm9yKGxldCBpPTA7IGk8cHJvY2Vzc2VzOyBpKyspIHsKICAgICAgICBjb25zdCBhbmdsZSA9IChpIC8gcHJvY2Vzc2VzKSAqIE1hdGguUEkgKiAyOwogICAgICAgIGNvbnN0IGxlbiA9IDEyOwogICAgICAgIGNvbnN0IGV4ID0geCArIE1hdGguY29zKGFuZ2xlKSAqIGxlbjsKICAgICAgICBjb25zdCBleSA9IHkgKyBNYXRoLnNpbihhbmdsZSkgKiBsZW47CiAgICAgICAgY29uc3QgY3ggPSB4ICsgTWF0aC5jb3MoYW5nbGUgKyAwLjUpICogKGxlbi8yKTsKICAgICAgICBjb25zdCBjeSA9IHkgKyBNYXRoLnNpbihhbmdsZSArIDAuNSkgKiAobGVuLzIpOwoKICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgY3R4Lm1vdmVUbyh4LCB5KTsKICAgICAgICBjdHgucXVhZHJhdGljQ3VydmVUbyhjeCwgY3ksIGV4LCBleSk7CiAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgfQp9CgpmdW5jdGlvbiBkcmF3KCl7CiAgICBjdHguY2xlYXJSZWN0KDAsMCxjb3J0ZXgud2lkdGgsY29ydGV4LmhlaWdodCk7CgogICAgLy8gLS0gQmFja2dyb3VuZCBMYXllcnMgLS0KICAgIGN0eC5mb250PSIxMnB4IHN5c3RlbS11aSI7CiAgICBsYXllcnMuZm9yRWFjaChMPT57CiAgICAgICAgY3R4LmZpbGxTdHlsZT0icmdiYSgyNTUsMjU1LDI1NSwuMDQpIjsKICAgICAgICBjdHguZmlsbFJlY3QoMCxMLnktMzAsY29ydGV4LndpZHRoLDYwKTsKICAgICAgICBjdHguZmlsbFN0eWxlPSJyZ2JhKDI1NSwyNTUsMjU1LC40KSI7CiAgICAgICAgY3R4LmZpbGxUZXh0KCJMYXllciAiK0wubmFtZSw4LEwueS0xOCk7CiAgICB9KTsKCiAgICAvLyAtLSBTa3VsbC9TY2FscCAtLQogICAgY3R4LmZpbGxTdHlsZT0icmdiYSgyMDAsMjAwLDI1NSwuMDgpIjsKICAgIGN0eC5maWxsUmVjdCgwLDAsY29ydGV4LndpZHRoLDIwKTsgCiAgICBjdHguZmlsbFN0eWxlPSJyZ2JhKDIwMCwyMDAsMjAwLC4xMikiOwogICAgY3R4LmZpbGxSZWN0KDAsMjAsY29ydGV4LndpZHRoLDIwKTsgCiAgICBjdHguZmlsbFN0eWxlPSJyZ2JhKDI1NSwyMDAsMjAwLC4xMikiOwogICAgY3R4LmZpbGxSZWN0KDAsNDAsY29ydGV4LndpZHRoLDIwKTsgCgogICAgLy8gLS0gV2lkZSBFbGVjdHJvZGUgLS0KICAgIGN0eC5maWxsU3R5bGU9InJnYmEoMjU1LDI1NSwyNTUsMC45KSI7CiAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAvLyBFbGxpcHNlIGNlbnRlciB4LCB5LCByYWRpdXNYLCByYWRpdXNZLCByb3RhdGlvbiwgc3RhcnQsIGVuZAogICAgY3R4LmVsbGlwc2UoY29ydGV4LndpZHRoLzIsIDIwLCBjb3J0ZXgud2lkdGgqMC40LCAxNCwgMCwgMCwgTWF0aC5QSSoyKTsKICAgIGN0eC5maWxsKCk7CiAgICAKICAgIC8vIEVsZWN0cm9kZSBMYWJlbAogICAgY3R4LmZpbGxTdHlsZSA9ICIjMDIwNjE3IjsKICAgIGN0eC5mb250ID0gImJvbGQgMTJweCBzeXN0ZW0tdWkiOwogICAgY3R4LnRleHRBbGlnbiA9ICJjZW50ZXIiOwogICAgY3R4LnRleHRCYXNlbGluZSA9ICJtaWRkbGUiOwogICAgY3R4LmZpbGxUZXh0KCJTY2FscCBFRUcgRWxlY3Ryb2RlIiwgY29ydGV4LndpZHRoLzIsIDIwKTsKICAgIGN0eC50ZXh0QWxpZ24gPSAibGVmdCI7IC8vIHJlc2V0CgogICAgY29uc3QgY29scz04LCBsYW5lcz00OwogICAgY29uc3QgZHg9Y29ydGV4LndpZHRoLyhjb2xzKzEpOwogICAgCiAgICAvLyBJbnB1dHMKICAgIGNvbnN0IGFsaWduVmFsID0gTnVtYmVyKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhbGlnbiIpLnZhbHVlKTsKICAgIGNvbnN0IGZyZXFWYWwgPSBOdW1iZXIoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZyZXEiKS52YWx1ZSk7CiAgICBjb25zdCBzaG93RmlyaW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInZpc3VhbGl6ZUZpcmluZyIpLmNoZWNrZWQ7CiAgICAKICAgIC8vIEZpeGVkIC8gSGlkZGVuIHBhcmFtZXRlcnMKICAgIGNvbnN0IHN5bmNWYWwgPSAwLjU7IAogICAgY29uc3QgZmllbGRUeXBlID0gIm9wZW4iOwoKICAgIGxldCBuZXRJbnN0YW50YW5lb3VzID0gMDsgCgogICAgZm9yKGxldCBjPTA7IGM8Y29sczsgYysrKXsKICAgICAgICBmb3IobGV0IGw9MDsgbDxsYW5lczsgbCsrKXsKICAgICAgICAgICAgY29uc3QgeCA9IGR4KihjKzEpICsgKGwtMS41KSoxMjsKICAgICAgICAgICAgY29uc3Qgc2VlZCA9IG5ldXJvbk1hcFtjXVtsXTsgCgogICAgICAgICAgICBsZXQgZGV2aWF0aW9uID0gc2VlZC5hbmdsZU9mZnNldCAqICgxIC0gYWxpZ25WYWwpOwogICAgICAgICAgICBjb25zdCB2ZXJ0aWNhbENvbnRyaWJ1dGlvbiA9IE1hdGguY29zKGRldmlhdGlvbik7CgogICAgICAgICAgICAvLyBQaGFzZSBjYWxjdWxhdGlvbgogICAgICAgICAgICBjb25zdCBwaGFzZSA9ICh0ICogZnJlcVZhbCAqIE1hdGguUEkgKiAyKSArIChzZWVkLnBoYXNlT2Zmc2V0ICogKDEgLSBzeW5jVmFsKSk7CiAgICAgICAgICAgIGNvbnN0IGFjdGl2aXR5ID0gTWF0aC5zaW4ocGhhc2UpOwoKICAgICAgICAgICAgLy8gMS4gTGF5ZXIgMi8zIFB5cmFtaWRhbAogICAgICAgICAgICBpZihsPT09MCAmJiBzaG93TDIzLmNoZWNrZWQpewogICAgICAgICAgICAgICAgY29uc3QgY29sID0gZ2V0RHluYW1pY0NvbG9yKCIjZmY3ODQ5IiwgYWN0aXZpdHksIHNob3dGaXJpbmcpOwogICAgICAgICAgICAgICAgZHJhd1B5cmFtaWRhbCh4LCBsYXllcnNbMV0ueSsyMCwgNTAsIGRldmlhdGlvbiwgY29sKTsKICAgICAgICAgICAgICAgIG5ldEluc3RhbnRhbmVvdXMgKz0gYWN0aXZpdHkgKiB2ZXJ0aWNhbENvbnRyaWJ1dGlvbiAqIDEuMDsgCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDIuIFN0ZWxsYXRlIChMYXllciA0KQogICAgICAgICAgICBpZihsPT09MSAmJiBzaG93U3RlbGxhdGUuY2hlY2tlZCl7CiAgICAgICAgICAgICAgICBjb25zdCBjb2wgPSBnZXREeW5hbWljQ29sb3IoIiM5YWE1ZmYiLCBhY3Rpdml0eSwgc2hvd0ZpcmluZyk7CiAgICAgICAgICAgICAgICBkcmF3U3RlbGxhdGVOZXVyb24oeCwgbGF5ZXJzWzJdLnksIGNvbCk7CiAgICAgICAgICAgICAgICBuZXRJbnN0YW50YW5lb3VzICs9IGFjdGl2aXR5ICogMC4wNTsgCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDMuIExheWVyIDYgUHlyYW1pZGFsIChMb25nZXIsIGNyb3NzaW5nIGxheWVycykKICAgICAgICAgICAgaWYobD49MiAmJiBzaG93TDYuY2hlY2tlZCl7CiAgICAgICAgICAgICAgICBjb25zdCBjb2wgPSBnZXREeW5hbWljQ29sb3IoIiNmZmQxYTgiLCBhY3Rpdml0eSwgc2hvd0ZpcmluZyk7CiAgICAgICAgICAgICAgICAvLyBMZW5ndGggaW5jcmVhc2VkIHRvIDIwMCB0byByZWFjaCBuZWFyIHRvcCBsYXllcnMKICAgICAgICAgICAgICAgIGRyYXdQeXJhbWlkYWwoeCwgbGF5ZXJzWzNdLnkrMjAsIDIwMCwgZGV2aWF0aW9uLCBjb2wpOwogICAgICAgICAgICAgICAgbmV0SW5zdGFudGFuZW91cyArPSBhY3Rpdml0eSAqIHZlcnRpY2FsQ29udHJpYnV0aW9uICogMS4yOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vIC0tIERyYXcgRUVHIFRyYWNlIC0tCiAgICBlY3R4LmNsZWFyUmVjdCgwLDAsZWVnLndpZHRoLGVlZy5oZWlnaHQpOwogICAgZWN0eC5zdHJva2VTdHlsZT0iIzM4YmRmOCI7CiAgICBlY3R4LmxpbmVXaWR0aD0yOwogICAgZWN0eC5iZWdpblBhdGgoKTsKCiAgICAvLyBFbnZlbG9wZSBjYWxjdWxhdGlvbgogICAgbGV0IHN5c3RlbUdhaW4gPSAwOwogICAgZm9yKGxldCBjPTA7IGM8Y29sczsgYysrKXsKICAgICAgICBmb3IobGV0IGw9MDsgbDxsYW5lczsgbCsrKXsKICAgICAgICAgICAgY29uc3Qgc2VlZCA9IG5ldXJvbk1hcFtjXVtsXTsKICAgICAgICAgICAgY29uc3QgZGV2aWF0aW9uID0gc2VlZC5hbmdsZU9mZnNldCAqICgxIC0gYWxpZ25WYWwpOwogICAgICAgICAgICBjb25zdCB2ZXJ0ID0gTWF0aC5jb3MoZGV2aWF0aW9uKTsKCiAgICAgICAgICAgIGlmKGw9PT0wICYmIHNob3dMMjMuY2hlY2tlZCkgc3lzdGVtR2FpbiArPSB2ZXJ0ICogMS4wOwogICAgICAgICAgICBpZihsPT09MSAmJiBzaG93U3RlbGxhdGUuY2hlY2tlZCkgc3lzdGVtR2FpbiArPSAwLjA1OyAKICAgICAgICAgICAgaWYobD49MiAmJiBzaG93TDYuY2hlY2tlZCkgc3lzdGVtR2FpbiArPSB2ZXJ0ICogMS4yOwogICAgICAgIH0KICAgIH0KCiAgICBjb25zdCBzeW5jRGFtcGluZyA9IDAuMSArICgwLjkgKiBzeW5jVmFsKTsgCiAgICBjb25zdCBmaW5hbEFtcCA9IHN5c3RlbUdhaW4gKiBzeW5jRGFtcGluZzsKCiAgICBmb3IobGV0IGk9MDsgaTxlZWcud2lkdGg7IGkrKyl7CiAgICAgICAgY29uc3QgdHQgPSB0IC0gKGVlZy53aWR0aCAtIGkpKjAuMDE7IAogICAgICAgIGNvbnN0IHdhdmUgPSBNYXRoLnNpbigyICogTWF0aC5QSSAqIGZyZXFWYWwgKiB0dCk7CiAgICAgICAgY29uc3QgeSA9IGVlZy5oZWlnaHQvMiAtIChmaW5hbEFtcCAqIHdhdmUgKiAyLjUpOyAKICAgICAgICBpZihpPT09MCkgZWN0eC5tb3ZlVG8oaSx5KTsgZWxzZSBlY3R4LmxpbmVUbyhpLHkpOwogICAgfQogICAgZWN0eC5zdHJva2UoKTsKfQoKZnVuY3Rpb24gbG9vcChub3cpewogICAgY29uc3QgZHQ9KG5vdy1sYXN0KS8xMDAwOwogICAgbGFzdD1ub3c7CiAgICB0Kz1kdDsKICAgIGRyYXcoKTsKICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShsb29wKTsKfQoKY29uc3Qgc2hvd0wyMz1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2hvd0wyMyIpOwpjb25zdCBzaG93TDY9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNob3dMNiIpOwpjb25zdCBzaG93U3RlbGxhdGU9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNob3dTdGVsbGF0ZSIpOwoKbG9vcChwZXJmb3JtYW5jZS5ub3coKSk7Cjwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4=";

    const demoA = document.getElementById("demoA");
    const demoB = document.getElementById("demoB");

    function loadA() {
      demoA.src = "data:text/html;base64," + DEMO_A_B64;
    }
    function loadB() {
      demoB.src = "data:text/html;base64," + DEMO_B_B64;
    }

    function reloadAll() {
      // Force a reload even if the src is unchanged
      demoA.removeAttribute("src");
      demoB.removeAttribute("src");
      loadA();
      loadB();
    }

    document.getElementById("reloadAll").addEventListener("click", reloadAll);

    // Initial load
    loadA();
    loadB();
  </script>
</body>
</html>
